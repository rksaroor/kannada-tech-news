<!DOCTYPE html>
<html lang="kn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ಟೆಕ್ ವಾರ್ತೆ — Kannada Tech News</title>
  <meta name="description" content="ಕನ್ನಡದಲ್ಲಿ ತಾಜಾ ತಂತ್ರಜ್ಞಾನ ಸುದ್ದಿ" />

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Kannada:wght@300;400;500;600;700;800;900&family=Space+Mono:wght@400;700&family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />

  <!-- Supabase CDN -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    /* ── Reset & Base ─────────────────────────────────── */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg:        #080808;
      --surface:   #101010;
      --surface2:  #181818;
      --border:    #1e1e1e;
      --border2:   #2a2a2a;
      --text:      #EDEDEB;
      --text2:     #999;
      --text3:     #555;
      --accent:    #FF4D2E;
      --font-kn:   'Noto Sans Kannada', sans-serif;
      --font-ui:   'Inter', sans-serif;
      --font-mono: 'Space Mono', monospace;
      --radius:    10px;
      --radius-lg: 16px;
    }

    html { scroll-behavior: smooth; }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: var(--font-ui);
      font-size: 14px;
      line-height: 1.6;
      min-height: 100vh;
    }

    a { color: inherit; text-decoration: none; }

    /* ── Breaking Ticker ──────────────────────────────── */
    .ticker-bar {
      background: var(--accent);
      color: #fff;
      height: 32px;
      display: flex;
      align-items: center;
      overflow: hidden;
    }
    .ticker-label {
      flex-shrink: 0;
      padding: 0 14px;
      background: rgba(0,0,0,0.25);
      height: 100%;
      display: flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
      font-family: var(--font-mono);
      font-size: 11px;
      font-weight: 600;
    }
    .ticker-scroll { flex: 1; overflow: hidden; }
    .ticker-content {
      display: inline-flex;
      animation: ticker 80s linear infinite;
      white-space: nowrap;
      font-family: var(--font-kn);
      font-size: 13px;
    }
    .ticker-content:hover { animation-play-state: paused; }
    .ticker-item { margin-right: 48px; }
    @keyframes ticker {
      0%   { transform: translateX(0); }
      100% { transform: translateX(-50%); }
    }

    /* ── Header ──────────────────────────────────────── */
    header {
      background: var(--surface);
      border-bottom: 1px solid var(--border);
      position: sticky;
      top: 0;
      z-index: 100;
    }
    .header-inner {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .logo-icon {
      width: 36px;
      height: 36px;
      border-radius: 8px;
      background: var(--accent);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      flex-shrink: 0;
    }
    .logo-text {
      font-family: var(--font-kn);
      font-size: 18px;
      font-weight: 800;
      color: var(--text);
    }
    .logo-sub {
      font-size: 10px;
      color: var(--text3);
      font-family: var(--font-mono);
      letter-spacing: 0.5px;
    }
    .header-right {
      display: flex;
      align-items: center;
      gap: 16px;
    }
    .header-date {
      font-family: var(--font-mono);
      font-size: 11px;
      color: var(--text3);
    }
    .live-badge {
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: 11px;
      font-weight: 600;
      color: #00E5A0;
      font-family: var(--font-mono);
    }
    .live-dot {
      width: 7px; height: 7px;
      border-radius: 50%;
      background: #00E5A0;
      animation: blink 2s ease-in-out infinite;
    }
    @keyframes blink {
      0%, 100% { opacity: 1; }
      50%       { opacity: 0.3; }
    }

    /* ── Category Nav ────────────────────────────────── */
    .cat-nav {
      background: var(--surface);
      border-bottom: 1px solid var(--border);
    }
    .cat-nav-inner {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
      display: flex;
      align-items: center;
      gap: 6px;
      overflow-x: auto;
      scrollbar-width: none;
      height: 44px;
    }
    .cat-nav-inner::-webkit-scrollbar { display: none; }
    .cat-btn {
      padding: 5px 14px;
      border-radius: 20px;
      border: 1px solid var(--border2);
      background: transparent;
      color: var(--text2);
      font-family: var(--font-kn);
      font-size: 13px;
      cursor: pointer;
      white-space: nowrap;
      transition: all 0.15s;
      flex-shrink: 0;
    }
    .cat-btn:hover { border-color: var(--accent); color: var(--text); }
    .cat-btn.active {
      background: var(--accent);
      border-color: var(--accent);
      color: #fff;
      font-weight: 600;
    }

    /* ── Main ────────────────────────────────────────── */
    main {
      max-width: 1200px;
      margin: 0 auto;
      padding: 32px 20px 60px;
    }

    .section-header {
      display: flex;
      align-items: baseline;
      gap: 12px;
      margin-bottom: 24px;
    }
    .section-title {
      font-family: var(--font-kn);
      font-size: 22px;
      font-weight: 800;
    }
    .section-count {
      font-family: var(--font-mono);
      font-size: 11px;
      color: var(--text3);
    }

    /* ── Featured ────────────────────────────────────── */
    .featured { margin-bottom: 40px; }
    .featured-card {
      display: grid;
      grid-template-columns: 1fr 1fr;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      overflow: hidden;
      cursor: pointer;
      transition: border-color 0.2s;
      min-height: 300px;
    }
    .featured-card:hover { border-color: var(--accent); }
    .featured-img-side {
      overflow: hidden;
      background: var(--surface2);
      min-height: 300px;
    }
    .featured-img {
      width: 100%; height: 100%;
      object-fit: cover; display: block;
    }
    .featured-no-img {
      width: 100%; height: 100%;
      min-height: 300px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 72px;
      background: linear-gradient(135deg, #1c1c1c 0%, #111 100%);
    }
    .featured-body {
      padding: 32px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    .featured-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 11px;
      font-weight: 700;
      letter-spacing: 0.5px;
      background: var(--accent);
      color: #fff;
      width: fit-content;
      margin-bottom: 14px;
    }
    .featured-cat {
      font-size: 11px;
      font-weight: 700;
      letter-spacing: 0.5px;
      text-transform: uppercase;
      margin-bottom: 10px;
    }
    .featured-title {
      font-family: var(--font-kn);
      font-size: 22px;
      font-weight: 800;
      line-height: 1.4;
      margin-bottom: 12px;
    }
    .featured-summary {
      font-family: var(--font-kn);
      font-size: 14px;
      color: var(--text2);
      line-height: 1.7;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
      margin-bottom: 20px;
    }
    .featured-meta {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 12px;
      color: var(--text3);
      margin-bottom: 16px;
    }
    .source-dot {
      width: 6px; height: 6px;
      border-radius: 50%;
      background: var(--accent);
      flex-shrink: 0;
    }
    .featured-source {
      display: flex;
      align-items: center;
      gap: 6px;
      color: var(--text2);
      font-weight: 600;
    }
    .read-btn {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 9px 20px;
      background: var(--accent);
      color: #fff;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 600;
      font-family: var(--font-kn);
      transition: background 0.15s;
      width: fit-content;
    }
    .read-btn:hover { background: #e6402a; }

    /* ── Article Grid ────────────────────────────────── */
    .articles-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
    }

    /* ── Article Card ────────────────────────────────── */
    .article-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      overflow: hidden;
      cursor: pointer;
      transition: transform 0.15s, border-color 0.15s;
      display: flex;
      flex-direction: column;
    }
    .article-card:hover {
      transform: translateY(-3px);
      border-color: var(--border2);
    }
    .card-img-wrap {
      width: 100%;
      aspect-ratio: 16/9;
      overflow: hidden;
      background: var(--surface2);
      flex-shrink: 0;
    }
    .card-img {
      width: 100%; height: 100%;
      object-fit: cover; display: block;
      transition: transform 0.3s;
    }
    .article-card:hover .card-img { transform: scale(1.04); }
    .card-no-img {
      width: 100%; height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 36px;
      background: linear-gradient(135deg, var(--surface2) 0%, var(--surface) 100%);
      border-bottom: 2px solid var(--cat-color, var(--accent));
    }
    .card-body {
      padding: 16px;
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    .card-cat-tag {
      font-size: 10px;
      font-weight: 700;
      letter-spacing: 0.5px;
      text-transform: uppercase;
      color: var(--cat-color, var(--accent));
      margin-bottom: 8px;
    }
    .card-title {
      font-family: var(--font-kn);
      font-size: 15px;
      font-weight: 700;
      line-height: 1.45;
      color: var(--text);
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
      margin-bottom: 8px;
    }
    .card-summary {
      font-family: var(--font-kn);
      font-size: 12.5px;
      color: var(--text3);
      line-height: 1.6;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      margin-bottom: 12px;
      flex: 1;
    }
    .card-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-top: 10px;
      border-top: 1px solid var(--border);
      font-size: 11px;
      color: var(--text3);
    }
    .card-source {
      display: flex;
      align-items: center;
      gap: 5px;
      font-weight: 600;
      color: var(--text2);
    }
    .card-time { font-family: var(--font-mono); font-size: 10px; }

    /* ── Skeleton ─────────────────────────────────────── */
    .skeleton {
      background: linear-gradient(90deg, #181818 25%, #222 50%, #181818 75%);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
      border-radius: 4px;
    }
    @keyframes shimmer {
      0%   { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }

    /* ── Load More ────────────────────────────────────── */
    .load-more-wrap { text-align: center; margin-top: 40px; }
    .load-more-btn {
      padding: 12px 32px;
      background: transparent;
      border: 1px solid var(--border2);
      border-radius: 8px;
      color: var(--text2);
      font-family: var(--font-kn);
      font-size: 14px;
      cursor: pointer;
      transition: all 0.15s;
    }
    .load-more-btn:hover { border-color: var(--accent); color: var(--accent); }
    .load-more-btn:disabled { opacity: 0.5; cursor: not-allowed; }

    /* ── Empty State ──────────────────────────────────── */
    .empty-state {
      grid-column: 1/-1;
      text-align: center;
      padding: 80px 20px;
      color: var(--text3);
      }
    .empty-icon { font-size: 48px; margin-bottom: 16px; }
    .empty-msg { font-family: var(--font-kn); font-size: 16px; margin-bottom: 6px; }

    /* ── Footer ───────────────────────────────────────── */
    footer {
      background: var(--surface);
      border-top: 1px solid var(--border);
      padding: 24px 20px;
    }
    .footer-inner {
      max-width: 1200px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 12px;
    }
    .footer-logo { font-family: var(--font-kn); font-size: 16px; font-weight: 800; }
    .footer-copy { font-size: 12px; color: var(--text3); }

    /* ── Responsive ───────────────────────────────────── */
    @media (max-width: 900px) {
      .articles-grid { grid-template-columns: repeat(2, 1fr); }
      .featured-card { grid-template-columns: 1fr; }
      .featured-title { font-size: 18px; }
    }
    @media (max-width: 600px) {
      .articles-grid { grid-template-columns: 1fr; }
      .featured-body { padding: 20px; }
      .featured-title { font-size: 17px; }
      .logo-sub { display: none; }
    }

    /* ── Fade-in ──────────────────────────────────────── */
    .fade-in { animation: fadeIn 0.35s ease; }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(8px); }
      to   { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>

<!-- ── Breaking Ticker ──────────────────────────────────────────────── -->
<div class="ticker-bar">
  <div class="ticker-label">&#9889; &#2340;&#2366;&#2332;&#2366;</div>
  <div class="ticker-scroll">
    <div class="ticker-content" id="tickerContent">
      <span class="ticker-item">&#2360;&#2369;&#2342;&#2381;&#2342;&#2367; &#2354;&#2379;&#2337;&#2381; &#2310;&#2327;&#2369;&#2340;&#2381;&#2340;&#2367;&#2342;&#2375;...</span>
    </div>
  </div>
</div>

<!-- ── Header ────────────────────────�────────────────────────────────── -->
<header>
  <div class="header-inner">
    <a class="logo" href="/">
      <div class="logo-icon">&#128225;</div>
      <div>
        <div class="logo-text">&#3335;&#3342;&#3381; &#3357;&#3390;&#3352;&#3381;&#3340;&#3375;</div>
        <div class="logo-sub">KANNADA TECH NEWS</div>
      </div>
    </a>
    <div class="header-right">
      <div class="live-badge">
        <div class="live-dot"></div>
        LIVE
      </div>
      <div class="header-date" id="headerDate"></div>
    </div>
  </div>
</header>

<!-- ── Category Nav ──────────────────────────────────────────────────── -->
<nav class="cat-nav">
  <div class="cat-nav-inner">
    <button class="cat-btn active" data-slug="all" onclick="filterByCategory('all', this)">&#3267;&#3262;&#3263;</button>
    <button class="cat-btn" data-slug="artificial-intelligence" onclick="filterByCategory('artificial-intelligence', this)">AI &#3274;&#3340;&#3381;&#3340;&#3370; ML</button>
    <button class="cat-btn" data-slug="smartphones" onclick="filterByCategory('smartphones', this)">&#3256;&#3277;&#3350;&#3390;&#3352;&#3381;&#3335;&#3277;&#8204;&#3347;&#3379;&#3344;&#3381;</button>
    <button class="cat-btn" data-slug="startups" onclick="filterByCategory('startups', this)">&#3256;&#3381;&#3335;&#3390;&#3352;&#3381;&#3335;&#3346;&#3381;</button>
    <button class="cat-btn" data-slug="cybersecurity" onclick="filterByCategory('cybersecurity', this)">&#3256;&#3376;&#3349;&#3352;&#3381; &#3349;&#3342;&#3381;&#3352;&#3340;&#3375;</button>
    <button class="cat-btn" data-slug="space-tech" onclick="filterByCategory('space-tech', this)">&#3349;&#3390;&#3361;&#3381;&#3351;&#3390;&#3325;&#3390;&#3358;</button>
    <button class="cat-btn" data-slug="gaming" onclick="filterByCategory('gaming', this)">&#3263;&#3375;&#3350;&#3367;&#3344;&#3381;</button>
    <button class="cat-btn" data-slug="electric-vehicles" onclick="filterByCategory('electric-vehicles', this)">&#3267;&#3354;&#3342;&#3381;&#3335;&#3381;&#3352;&#3367;&#3325;&#3381; &#3357;&#3390;&#3361;&#3344;</button>
    <button class="cat-btn" data-slug="social-media" onclick="filterByCategory('social-media', this)">&#3256;&#3390;&#3350;&#3390;&#3332;&#3367;&#3325; &#3350;&#3390;&#3343;&#3381;&#3351;&#3350;</button>
  </div>
</nav>

<!-- ── Main Content ───────────────────────────────────────────────────── -->
<main>

  <div class="section-header fade-in">
    <h2 class="section-title">&#3271;&#3340;&#3381;&#3340;&#3368;&#3379;&#3330;&#3367;&#3344; &#3256;&#3369;&#3342;&#3381;&#3342;&#3367;&#3327;&#3379;&#3379;</h2>
    <span class="section-count" id="articleCount"></span>
  </div>

  <!-- Featured -->
  <div class="featured fade-in" id="featuredSection">
    <div style="background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-lg);height:300px;" class="skeleton"></div>
  </div>

  <!-- Grid -->
  <div class="articles-grid fade-in" id="articlesGrid">
    <div style="background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);height:280px;" class="skeleton"></div>
    <div style="background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);height:280px;" class="skeleton"></div>
    <div style="background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);height:280px;" class="skeleton"></div>
    <div style="background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);height:280px;" class="skeleton"></div>
    <div style="background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);height:280px;" class="skeleton"></div>
    <div style="background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);height:280px;" class="skeleton"></div>
  </div>

  <!-- Load More -->
  <div class="load-more-wrap" id="loadMoreWrap" style="display:none;">
    <button class="load-more-btn" onclick="loadMore()">&#3267;&#3344;&#3381;&#3344;&#3359;&#3381;&#3335;&#3369; &#3256;&#3369;&#3342;&#3381;&#3342;&#3367;&#3327;&#3379;&#3379; &#3344;&#3379;&#3337;&#3367; &#8594;</button>
  </div>

</main>

<!-- ── Footer ────────────────────────────────────────────────────────── -->
<footer>
  <div class="footer-inner">
    <div class="footer-logo">&#128225; &#3335;&#3342;&#3381; &#3357;&#3390;&#3352;&#3381;&#3340;&#3375;</div>
    <div class="footer-copy">&#169; 2025 &#3335;&#3342;&#3381; &#3357;&#3390;&#3352;&#3381;&#3340;&#3375; &middot; Built with &#9829; for Karnataka</div>
  </div>
</footer>

<script>
  // ── Config ───────────────────────────────────────────────────────────────
  const SUPABASE_URL      = 'https://bnwdxuzvpgzkdqswrrgc.supabase.co'
  const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJud2R4dXp2cGd6a2Rxc3dycmdjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzIxNjQxMzQsImV4cCI6MjA4Nzc0MDEzNH0.IRVjVeNLW6FY2QNK-8LGUBtum-1MsUjhSCQNUVUr_nk'

  const { createClient } = supabase
  const db = createClient(SUPABASE_URL, SUPABASE_ANON_KEY)

  // ── State ────────────────────────────────────────────────────────────────
  let currentCategory = 'all'
  let currentPage     = 0
  const PAGE_SIZE     = 9

  // ── Date ─────────────────────────────────────────────────────────────────
  document.getElementById('headerDate').textContent =
    new Date().toLocaleDateString('kn-IN', { weekday: 'short', day: 'numeric', month: 'short', year: 'numeric' })

  // ── Helpers ──────────────────────────────────────────────────────────────
  function timeAgo(dateStr) {
    if (!dateStr) return ''
    const diff = (Date.now() - new Date(dateStr)) / 1000
    if (diff < 60)    return '\u0c87\u0ca6\u0cc0\u0c97'
    if (diff < 3600)  return Math.floor(diff/60)    + ' \u0ca8\u0cbf\u0cae\u0cbf\u0cb7 \u0cb9\u0cbf\u0c82\u0ca6\u0cc6'
    if (diff < 86400) return Math.floor(diff/3600)  + ' \u0c97\u0c82\u0c9f\u0cc6 \u0cb9\u0cbf\u0c82\u0ca6\u0cc6'
    return Math.floor(diff/86400) + ' \u0ca6\u0cbf\u0ca8 \u0cb9\u0cbf\u0c82\u0ca6\u0cc6'
  }

  function catColor(a) { return a.categories?.color || '#FF4D2E'}

  function catEmoji(slug) {
    const m = {
      'artificial-intelligence': '\uD83E\uDD16',
      'smartphones':  '\uD83D\uDCF1',
      'startups':     '\uD83D\uDE80',
      'cybersecurity':'\uD83D\uDD12',
      'space-tech':   '\uD83D\uDEF8',
      'gaming':       '\uD83C\uDFAE',
      'electric-vehicles': '\u26A1',
      'social-media': '\uD83D\uDCF2',
    }
    return m[slug] || '\uD83D\uDCF0'
  }

  // Returns only real, non-stock images (filters picsum and pollinations)
  function realImg(url) {
    if (!url) return null
    if (url.includes('picsum.photos'))    return null
    if (url.includes('pollinations.ai')) return null
    return url
  }

  // ── Featured Card ─────────────────────────────────────────────────────────
  function renderFeatured(a) {
    const img    = realImg(a.thumbnail_url)
    const color  = catColor(a)
    const emoji  = catEmoji(a.categories?.slug || '')
    const catKn  = a.categories?.name_kn || ''

    const imgSide = img
      ? `<div class="featured-img-side"><img class="featured-img" src="${img}" alt="" loading="lazy" onerror="this.parentElement.innerHTML='<div class=\\'featured-no-img\\'>${emoji}</div>'"></div>`
      : `<div class="featured-img-side"><div class="featured-no-img">${emoji}</div></div>`

    return `<div class="featured-card" onclick="window.open('${a.source_url}','_blank')">
      ${imgSide}
      <div class="featured-body">
        <div>
          <div class="featured-badge">\u2B50 \u0cae\u0cc1\u0c96\u0ccd\u0caf \u0cb8\u0cc1\u0ca6\u0ccd\u0ca6\u0cbf</div>
          ${catKn ? `<div class="featured-cat" style="color:${color}">${catKn}</div>` : ''}
          <h2 class="featured-title">${a.title_kn}</h2>
          <p class="featured-summary">${a.summary_kn || ''}</p>
        </div>
        <div>
          <div class="featured-meta">
            <div class="featured-source">
              <div class="source-dot" style="background:${color}"></div>
              ${a.source_name}
            </div>
            <span>\u00b7</span>
            <span>${timeAgo(a.published_at)}</span>
          </div>
          <a class="read-btn" href="${a.source_url}" target="_blank" onclick="event.stopPropagation()">
            \u0cae\u0cc1\u0c82\u0ca6\u0cc6 \u0c93\u0ca6\u0cbf \u2192
          </a>
        </div>
      </div>
    </div>`
  }

  // ── Article Card ──────────────────────────────────────────────────────────
  function renderCard(a) {
    const img   = realImg(a.thumbnail_url)
    const color = catColor(a)
    const emoji = catEmoji(a.categories?.slug || '')
    const catKn = a.categories?.name_kn || ''

    const imgHtml = img
      ? `<div class="card-img-wrap"><img class="card-img" src="${img}" alt="" loading="lazy" onerror="this.parentElement.outerHTML='<div class=\\'card-img-wrap\\'><div class=\\'card-no-img\\' style=\\"--cat-color:${color}\\">${emoji}</div></div>'"></div>`
      : `<div class="card-img-wrap"><div class="card-no-img" style="--cat-color:${color}">${emoji}</div></div>`

    return `<div class="article-card" style="--cat-color:${color}" onclick="window.open('${a.source_url}','_blank')">
      ${imgHtml}
      <div class="card-body">
        ${catKn ? `<div class="card-cat-tag">${catKn}</div>` : ''}
        <h3 class="card-title">${a.title_kn}</h3>
        <p class="card-summary">${a.summary_kn || ''}</p>
        <div class="card-footer">
          <div class="card-source">
            <div class="source-dot"></div>
            ${a.source_name}
          </div>
          <span class="card-time">${timeAgo(a.published_at)}</span>
        </div>
      </div>
    </div>`
  }

  // ── Fetch ─────────────────────────────────────────────────────────────────
  async function fetchArticles(page = 0, catSlug = 'all') {
    let q = db
      .from('articles')
      .select('*, categories(name_kn, name_en, slug, color)')
      .eq('is_published', true)
      .order('published_at', { ascending: false })
      .range(page * PAGE_SIZE, (page + 1) * PAGE_SIZE - 1)

    if (catSlug !== 'all') {
      const { data: c } = await db.from('categories').select('id').eq('slug', catSlug).single()
      if (c) q = q.eq('category_id', c.id)
    }

    const { data, error } = await q
    if (error) { console.error(error); return [] }
    return data || []
  }

  // ── Load Initial ──────────────────────────────────────────────────────────
  async function loadInitial() {
    const articles = await fetchArticles(0, currentCategory)

    if (!articles.length) {
      document.getElementById('featuredSection').innerHTML = ''
      document.getElementById('articlesGrid').innerHTML = `
        <div class="empty-state">
          <div class="empty-icon">\uD83D\uDCED</div>
          <div class="empty-msg">\u0c86\u0caf\u0ccd\u0c95\u0cc6 \u0cae\u0cbe\u0ca1\u0cbf\u0ca6 \u0cb5\u0cb0\u0ccd\u0c97\u0ca6\u0cb2\u0ccd\u0cb2\u0cbf \u0cb8\u0ca6\u0ccd\u0caf\u0c95\u0ccd\u0c95\u0cc6 \u0cb8\u0cc1\u0ca6\u0ccd\u0ca6\u0cbf\u0c97\u0cb3\u0cbf\u0cb2\u0ccd\u0cb2</div>
        </div>`
      return
    }

    // Featured = article[0]
    document.getElementById('featuredSection').innerHTML =
      `<div class="fade-in">${renderFeatured(articles[0])}</div>`

    // Grid = articles[1..n]
    const grid = document.getElementById('articlesGrid')
    grid.innerHTML = articles.slice(1).map(renderCard).join('')

    // Ticker — duplicate for seamless scroll
    const tickerHtml = articles.map(a => `<span class="ticker-item">\u2022 ${a.title_kn}</span>`).join('')
    document.getElementById('tickerContent').innerHTML = tickerHtml + tickerHtml

    // Count
    document.getElementById('articleCount').textContent = `${articles.length}+ \u0cb8\u0cc1\u0ca6\u0ccd\u0ca6\u0cbf\u0c97\u0cb3\u0cc1`

    // Load more
    document.getElementById('loadMoreWrap').style.display =
      articles.length >= PAGE_SIZE ? 'block' : 'none'

    currentPage = 0
  }

  // ── Load More ─────────────────────────────────────────────────────────────
  async function loadMore() {
    currentPage++
    const btn = document.querySelector('.load-more-btn')
    btn.textContent = '\u0cb2\u0cc7\u0cbe\u0ca1\u0ccd \u0c86\u0c97\u0cc1\u0ca4\u0ccd\u0ca4\u0cbf\u0ca6\u0cc6...'
    btn.disabled = true

    const articles = await fetchArticles(currentPage, currentCategory)
    const grid = document.getElementById('articlesGrid')
    articles.forEach(a => {
      const el = document.createElement('div')
      el.innerHTML = renderCard(a)
      el.firstElementChild.classList.add('fade-in')
      grid.appendChild(el.firstElementChild)
    })

    btn.textContent = '\u0c87\u0ca8\u0ccd\u0ca8\u0cb7\u0ccd\u0c9f\u0cc1 \u0cb8\u0cc1\u0ca6\u0ccd\u0ca6\u0cbf\u0c97\u0cb3\u0cc1 \u0ca8\u0ccb\u0ca1\u0cbf \u2192'
    btn.disabled = false

    if (articles.length < PAGE_SIZE) {
      document.getElementById('loadMoreWrap').style.display = 'none'
    }
  }

  // ── Filter ────────────────────────────────────────────────────────────────
  function filterByCategory(slug, btn) {
    currentCategory = slug
    currentPage = 0
    document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'))
    btn.classList.add('active')
    document.getElementById('featuredSection').innerHTML =
      `<div style="background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-lg);height:300px;" class="skeleton"></div>`
    document.getElementById('articlesGrid').innerHTML = [1,2,3,4,5,6].map(() =>
      `<div style="background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);height:280px;" class="skeleton"></div>`
    ).join('')
    loadInitial()
  }

  // ── Init ──────────────────────────────────────────────────────────────────
  loadInitial()
</script>

</body>
</html>
