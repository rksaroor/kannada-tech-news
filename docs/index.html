<!DOCTYPE html>
<html lang="kn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>टೆಕ್ ವಾರ್ತೆ — Kannada Tech News</title>
  <meta name="description" content="ಕನ್ನಡದಲ್ಲಿ ತಾಜಾ ತಂತ್ರಜ್ಞಾನ ಸುದ್ದಿ" />
  
  <!-- Google Fonts: Noto Sans Kannada + display font -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Kannada:wght@300;400;500;600;700;800;900&family=Space+Mono:wght@400;700&family=Syne:wght@700;800&display=swap" rel="stylesheet" />

  <!-- Supabase CDN -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    /* ── Reset & Base ────────────────────────────────────────────── */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg: #0A0A0A;
      --surface: #111111;
      --surface2: #181818;
      --border: #222222;
      --text: #F0EDE8;
      --muted: #888888;
      --accent: #FF5733;       /* vibrant red-orange */
      --accent2: #FFB347;      /* warm gold */
      --accent3: #00E5A0;      /* mint green for featured */
      --font-kn: 'Noto Sans Kannada', sans-serif;
      --font-mono: 'Space Mono', monospace;
      --font-display: 'Syne', sans-serif;
    }

    html { scroll-behavior: smooth; }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: var(--font-kn);
      min-height: 100vh;
      line-height: 1.6;
      overflow-x: hidden;
    }

    /* ── Scrollbar ─────────────────────────────────────────────── */
    ::-webkit-scrollbar { width: 4px; }
    ::-webkit-scrollbar-track { background: var(--bg); }
    ::-webkit-scrollbar-thumb { background: var(--accent); border-radius: 2px; }

    /* ── Nav ──────────────────────────────────────────────────── */
    nav {
      position: sticky;
      top: 0;
      z-index: 100;
      background: rgba(10,10,10,0.95);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid var(--border);
      padding: 0 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      height: 56px;
    }
    .nav-brand {
      font-family: var(--font-display);
      font-size: 1.25rem;
      font-weight: 800;
      color: var(--accent);
      letter-spacing: -0.5px;
    }
    .nav-brand span { color: var(--text); }
    .nav-cats {
      display: flex;
      gap: 4px;
      overflow-x: auto;
      scrollbar-width: none;
    }
    .nav-cats::-webkit-scrollbar { display: none; }
    .cat-btn {
      padding: 5px 14px;
      border-radius: 20px;
      border: 1px solid transparent;
      background: transparent;
      color: var(--muted);
      font-family: var(--font-kn);
      font-size: 0.8rem;
      cursor: pointer;
      white-space: nowrap;
      transition: all 0.2s;
    }
    .cat-btn:hover { color: var(--text); border-color: var(--border); }
    .cat-btn.active {
      background: var(--accent);
      color: #fff;
      border-color: var(--accent);
    }

    /* ── Layout ────────────────────────────────────────────────── */
    .page-wrap {
      max-width: 1200px;
      margin: 0 auto;
      padding: 32px 20px 80px;
    }

    /* ── Hero Grid ─────────────────────────────────────────────── */
    .hero-grid {
      display: grid;
      grid-template-columns: 1fr 340px;
      grid-template-rows: auto auto;
      gap: 12px;
      margin-bottom: 40px;
    }
    @media (max-width: 768px) {
      .hero-grid { grid-template-columns: 1fr; }
    }

    /* ── Hero Card ──────────────────────────────────────────────── */
    .hero-card {
      grid-row: 1 / 3;
      position: relative;
      border-radius: 16px;
      overflow: hidden;
      cursor: pointer;
      aspect-ratio: 16/10;
      background: var(--surface);
    }
    .hero-card img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
      transition: transform 0.4s;
    }
    .hero-card:hover img { transform: scale(1.03); }
    .hero-overlay {
      position: absolute;
      inset: 0;
      background: linear-gradient(to top, rgba(0,0,0,0.85) 0%, rgba(0,0,0,0.2) 50%, transparent 100%);
    }
    .hero-content {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      padding: 24px;
    }
    .hero-cat {
      display: inline-block;
      background: var(--accent);
      color: #fff;
      font-size: 0.7rem;
      font-weight: 600;
      padding: 3px 10px;
      border-radius: 12px;
      margin-bottom: 10px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .hero-title {
      font-size: clamp(1.1rem, 2.5vw, 1.6rem);
      font-weight: 800;
      line-height: 1.3;
      color: #fff;
      margin-bottom: 8px;
    }
    .hero-meta {
      font-family: var(--font-mono);
      font-size: 0.7rem;
      color: rgba(255,255,255,0.6);
    }

    /* ── Side Cards ────────────────────────────────────────────── */
    .side-card {
      border-radius: 12px;
      overflow: hidden;
      cursor: pointer;
      background: var(--surface);
      display: flex;
      flex-direction: column;
      transition: transform 0.2s;
    }
    .side-card:hover { transform: translateY(-2px); }
    .side-thumb {
      width: 100%;
      aspect-ratio: 16/9;
      overflow: hidden;
      background: var(--surface2);
    }
    .side-thumb img { width: 100%; height: 100%; object-fit: cover; display: block; transition: transform 0.3s; }
    .side-card:hover .side-thumb img { transform: scale(1.05); }
    .side-body {
      padding: 14px;
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .side-cat {
      font-size: 0.65rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .side-title {
      font-size: 0.9rem;
      font-weight: 700;
      line-height: 1.4;
      color: var(--text);
    }
    .side-meta {
      font-family: var(--font-mono);
      font-size: 0.65rem;
      color: var(--muted);
      margin-top: auto;
    }

    /* ── Section Header ─────────────────────────────────────────── */
    .section-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 20px;
    }
    .section-title {
      font-family: var(--font-display);
      font-size: 1.1rem;
      font-weight: 800;
      color: var(--text);
      letter-spacing: -0.3px;
    }
    .section-line {
      flex: 1;
      height: 1px;
      background: var(--border);
    }

    /* ── Article Grid ───────────────────────────────────────────── */
    .article-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
    }

    .article-card {
      background: var(--surface);
      border-radius: 14px;
      overflow: hidden;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      border: 1px solid var(--border);
    }
    .article-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 32px rgba(0,0,0,0.4);
    }

    .article-thumb {
      position: relative;
      aspect-ratio: 16/9;
      overflow: hidden;
      background: var(--surface2);
    }
    .article-thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
      transition: transform 0.3s;
    }
    .article-card:hover .article-thumb img { transform: scale(1.05); }

    .cat-tag {
      position: absolute;
      top: 10px;
      left: 10px;
      font-size: 0.65rem;
      font-weight: 700;
      color: #fff;
      padding: 3px 8px;
      border-radius: 8px;
      text-transform: uppercase;
      letter-spacing: 0.4px;
    }

    .article-body {
      padding: 16px;
    }
    .article-title {
      font-size: 0.95rem;
      font-weight: 700;
      line-height: 1.4;
      margin-bottom: 8px;
      color: var(--text);
    }
    .article-summary {
      font-size: 0.82rem;
      color: var(--muted);
      line-height: 1.6;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
      margin-bottom: 12px;
    }
    .article-footer {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .article-source {
      font-family: var(--font-mono);
      font-size: 0.65rem;
      color: var(--muted);
    }
    .article-date {
      font-family: var(--font-mono);
      font-size: 0.65rem;
      color: var(--muted);
    }
    .read-more {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--accent);
      text-decoration: none;
      margin-top: 8px;
      transition: gap 0.2s;
    }
    .read-more:hover { gap: 8px; }

    /* ── Load More ──────────────────────────────────────────────── */
    .load-more-wrap { text-align: center; margin: 40px 0 20px; }
    #loadMoreBtn {
      padding: 12px 36px;
      background: transparent;
      border: 1px solid var(--border);
      color: var(--text);
      border-radius: 8px;
      font-family: var(--font-kn);
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.2s;
    }
    #loadMoreBtn:hover { border-color: var(--accent); color: var(--accent); }
    #loadMoreBtn:disabled { opacity: 0.4; cursor: default; }

    /* ── Ticker ────────────────────────────────────────────────── */
    .ticker-wrap {
      background: var(--accent);
      padding: 8px 0;
      overflow: hidden;
      margin-bottom: 32px;
      border-radius: 8px;
    }
    .ticker-inner {
      display: flex;
      gap: 60px;
      animation: ticker 30s linear infinite;
      white-space: nowrap;
    }
    .ticker-inner:hover { animation-play-state: paused; }
    @keyframes ticker {
      0% { transform: translateX(0); }
      100% { transform: translateX(-50%); }
    }
    .ticker-item {
      font-family: var(--font-mono);
      font-size: 0.75rem;
      font-weight: 700;
      color: #fff;
      cursor: pointer;
      flex-shrink: 0;
    }
    .ticker-item::before { content: '▶︎  '; }

    /* ── Skeleton ──────────────────────────────────────────────── */
    .skeleton { animation: pulse 1.5s ease-in-out infinite; background: var(--surface2); border-radius: 6px; }
    @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.4} }

    /* ── Footer ──────────────────────────────────────────────── */
    footer {
      border-top: 1px solid var(--border);
      padding: 24px 20px;
      text-align: center;
      font-family: var(--font-mono);
      font-size: 0.7rem;
      color: var(--muted);
    }
    footer a { color: var(--accent); text-decoration: none; }
  </style>
</head>
<body>

<!-- ── Nav ────────────────────────────────────────────────────────────── -->
<nav>
  <div class="nav-brand">टೆಕ್ <span>ವಾರ್ತೆ</span></div>
  <div class="nav-cats" id="navCats"></div>
</nav>

<!-- ── Main ───────────────────────────────────────────────────────────── -->
<main class="page-wrap">
  <!-- Ticker -->
  <div class="ticker-wrap" id="tickerWrap" style="display:none">
    <div class="ticker-inner" id="tickerInner"></div>
  </div>

  <!-- Hero -->
  <div class="hero-grid" id="heroGrid"></div>

  <!-- More Articles -->
  <div class="section-header">
    <h2 class="section-title">ಇಂದಿನ ಸುದ್ದಿ</h2>
    <div class="section-line"></div>
  </div>
  <div class="article-grid" id="articleGrid"></div>

  <div class="load-more-wrap">
    <button id="loadMoreBtn" style="display:none">ಇನ್ನೂ ಸುದ್ದಿ ತರಿ</button>
  </div>
</main>

<footer>
  © 2025 टೆಕ್ ವಾರ್ತೆ &mdash; ಕನ್ನಡದಲ್ಲಿ ತಂತ್ರಜ್ಞಾನ ಸುದ್ದಿ &nbsp;|&nbsp;
  Powered by <a href="https://anthropic.com" target="_blank">Claude AI</a> &amp; <a href="https://supabase.com" target="_blank">Supabase</a>
</footer>

<script>
  // ── Supabase client ──────────────────────────────────────────────
  const SUPA_URL = 'https://bnwdxuzvpgzkdqswrrgc.supabase.co'
  const SUPA_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJud2R4dXp2cGd6a2Rxc3dycmdjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDgxNzMwODEsImV4cCI6MjA2Mzc0OTA4MX0.dJYbgV25AMidKUCLJ24UnXX5RF4GECOHhCiwG0XLKKY'
  const sb = supabase.createClient(SUPA_URL, SUPA_KEY)

  // ── State ─────────────────────────────────────────────────────
  let currentCat = null
  let page = 0
  const PAGE_SIZE = 12
  let allArticles = []

  // ── Category colours ───────────────────────────────────────────
  const CAT_COLORS = {
    'artificial-intelligence': '#7C3AED',
    'smartphones':             '#0EA5E9',
    'startups':                '#F59E0B',
    'cybersecurity':           '#EF4444',
    'space-tech':              '#06B6D4',
    'gaming':                  '#10B981',
    'electric-vehicles':       '#22C55E',
    'social-media':            '#EC4899',
  }

  // ── Thumbnail (picsum.photos — free, deterministic, always available) ────
  function picsumUrl(seed) {
    // Derive a clean seed string from the article title/slug
    const s = (seed || 'tech-news').toLowerCase().replace(/[^a-z0-9]+/g, '-').substring(0, 40)
    return `https://picsum.photos/seed/${s}/1200/630`
  }
  function thumbHtml(url, size = 'full', titleEn = '') {
    const src = url || picsumUrl(titleEn)
    const style = size === 'full' ? '' : ' style="width:100%;height:100%;object-fit:cover;"'
    return `<img src="${src}" alt="" loading="lazy"${style} onerror="this.style.background='#1e293b'">`
  }

  // ── Date formatter ─────────────────────────────────────────────
  function fmtDate(iso) {
    if (!iso) return ''
    const d = new Date(iso)
    return d.toLocaleDateString('kn-IN', { day: 'numeric', month: 'short', year: 'numeric' })
  }

  // ── Render hero + side cards ──────────────────────────────────────
  function renderHero(articles) {
    const heroGrid = document.getElementById('heroGrid')
    if (!articles.length) { heroGrid.innerHTML = ''; return }

    const hero = articles[0]
    const color = hero.categories ? (CAT_COLORS[hero.categories.slug] || 'var(--accent)') : 'var(--accent)'

    const heroCard = `
      <div class="hero-card" onclick="window.open('${hero.source_url}','_blank')">
        ${thumbHtml(hero.thumbnail_url, 'full', hero.title_en)}
        <div class="hero-overlay"></div>
        <div class="hero-content">
          ${hero.categories ? `<span class="hero-cat" style="background:${color}">${hero.categories.name_kn}</span>` : ''}
          <div class="hero-title">${hero.title_kn}</div>
          <div class="hero-meta">${hero.source_name} &nbsp;·&nbsp; ${fmtDate(hero.published_at || hero.created_at)}</div>
        </div>
      </div>`

    const sideCards = articles.slice(1, 3).map(a => `
      <div class="side-card" onclick="window.open('${a.source_url}','_blank')">
        <div class="side-thumb">${thumbHtml(a.thumbnail_url, 'side', a.title_en)}</div>
        <div class="side-body">
          <div class="side-title">${a.title_kn}</div>
          <div class="side-meta">${a.source_name} · ${fmtDate(a.published_at || a.created_at)}</div>
        </div>
      </div>`).join('')

    heroGrid.innerHTML = heroCard + sideCards
  }

  // ── Render article cards ────────────────────────────────────────────
  function renderCards(articles, append = false) {
    const grid = document.getElementById('articleGrid')
    const html = articles.map(a => {
      const color = a.categories ? (CAT_COLORS[a.categories.slug] || 'var(--accent)') : 'var(--accent)'
      return `
        <div class="article-card" onclick="window.open('${a.source_url}','_blank')">
          <div class="article-thumb">
            ${thumbHtml(a.thumbnail_url, 'full', a.title_en)}
            ${a.categories ? `<div class="cat-tag" style="background:${color}">${a.categories.name_kn}</div>` : ''}
          </div>
          <div class="article-body">
            <div class="article-title">${a.title_kn}</div>
            <div class="article-summary">${a.summary_kn}</div>
            <div class="article-footer">
              <span class="article-source">${a.source_name}</span>
              <span class="article-date">${fmtDate(a.published_at || a.created_at)}</span>
            </div>
            <a class="read-more" href="${a.source_url}" target="_blank" onclick="event.stopPropagation()">ಮೂಲ ವಾರ್ತೆ →</a>
          </div>
        </div>`
    }).join('')
    if (append) grid.insertAdjacentHTML('beforeend', html)
    else grid.innerHTML = html
  }

  // ── Ticker ──────────────────────────────────────────────────────
  function renderTicker(articles) {
    const inner = document.getElementById('tickerInner')
    const wrap = document.getElementById('tickerWrap')
    if (!articles.length) return
    const items = [...articles, ...articles].map(a =>
      `<span class="ticker-item" onclick="window.open('${a.source_url}','_blank')">${a.title_kn}</span>`
    ).join('')
    inner.innerHTML = items
    wrap.style.display = 'block'
  }

  // ── Category nav ────────────────────────────────────────────────
  async function loadCategories() {
    const { data } = await sb.from('categories').select('*').order('name_en')
    const nav = document.getElementById('navCats')
    if (!data) return
    const allBtn = `<button class="cat-btn active" onclick="filterCat(null,this)">สักการักษา</button>`
    // fallback: use 'ಎಲ್ಲಾ' in Kannada
    const allBtnKn = `<button class="cat-btn active" onclick="filterCat(null,this)">ಎಲ್ಲಾ</button>`
    nav.innerHTML = allBtnKn + data.map(c =>
      `<button class="cat-btn" onclick="filterCat('${c.id}',this)">${c.name_kn}</button>`
    ).join('')
  }

  function filterCat(catId, btn) {
    currentCat = catId
    page = 0
    document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'))
    btn.classList.add('active')
    loadArticles(false)
  }

  // ── Load articles ────────────────────────────────────────────────
  async function loadArticles(append = false) {
    let q = sb
      .from('articles')
      .select('*, categories(id, slug, name_kn, name_en)')
      .eq('is_published', true)
      .order('created_at', { ascending: false })
      .range(page * PAGE_SIZE, (page + 1) * PAGE_SIZE - 1)

    if (currentCat) q = q.eq('category_id', currentCat)

    const { data, error } = await q
    if (error) { console.error(error); return }

    if (!append) {
      allArticles = data
      renderHero(data.slice(0, 3))
      renderCards(data.slice(3))
      renderTicker(data)
    } else {
      allArticles = [...allArticles, ...data]
      renderCards(data, true)
    }

    const btn = document.getElementById('loadMoreBtn')
    if (data.length === PAGE_SIZE) {
      btn.style.display = 'inline-block'
      btn.disabled = false
    } else {
      btn.style.display = 'none'
    }
  }

  document.getElementById('loadMoreBtn').addEventListener('click', () => {
    page++
    loadArticles(true)
  })

  // ── Init ───────────────────────────────────────────────────────
  loadCategories()
  loadArticles()
</script>

</body>
</html>
